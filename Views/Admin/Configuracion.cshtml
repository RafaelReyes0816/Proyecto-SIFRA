@{
    ViewData["Title"] = "Configuraci√≥n del Sistema";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@{
    // Usamos dynamic para config y convertimos la lista a IEnumerable para evitar problemas en el foreach
    var config = ViewBag.Configuracion as dynamic;
    var distribucionRoles = ViewBag.DistribucionRoles as System.Collections.IEnumerable;
}

<div class="container-fluid dark-theme" style="min-height: 100vh; padding: 2rem;">
    <div class="d-flex justify-content-between align-items-center mb-4 fade-in-up">
        <div>
            <h2 class="mb-1" style="font-weight: 700;">‚öôÔ∏è Configuraci√≥n del Sistema</h2>
            <p class="text-muted mb-0">Informaci√≥n general y configuraciones</p>
        </div>
        <a asp-action="Dashboard" class="btn btn-outline-light">
            ‚Üê Volver al Dashboard
        </a>
    </div>

    <!-- Informaci√≥n del Sistema -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="stat-card-dark bg-dark-primary">
                <h5>üë• Total Usuarios</h5>
                <!-- Se agrega ? para evitar el error CS8602 y ?? 0 para valor por defecto -->
                <h2>@(config?.TotalUsuarios ?? 0)</h2>
                <small style="opacity: 0.8;">@(config?.UsuariosActivos ?? 0) activos</small>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="stat-card-dark bg-dark-success">
                <h5>üë§ Total Clientes</h5>
                <h2>@(config?.TotalClientes ?? 0)</h2>
                <small style="opacity: 0.8;">@(config?.ClientesVerificados ?? 0) verificados</small>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="stat-card-dark bg-dark-info">
                <h5>üì¶ Total Productos</h5>
                <h2>@(config?.TotalProductos ?? 0)</h2>
                <small style="opacity: 0.8;">En @(config?.TotalCategorias ?? 0) categor√≠as</small>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="stat-card-dark bg-dark-warning">
                <h5>‚è≥ Ventas Pendientes</h5>
                <h2>@(config?.VentasPendientes ?? 0)</h2>
                <small style="opacity: 0.8;">Requieren atenci√≥n</small>
            </div>
        </div>
    </div>

    <!-- Distribuci√≥n de Roles y Estad√≠sticas -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card fade-in-up">
                <div class="card-header">
                    <h5 class="mb-0 icon-glow">üë• Distribuci√≥n de Roles de Usuario</h5>
                </div>
                <div class="card-body">
                    @if (distribucionRoles != null)
                    {
                        @foreach (dynamic rol in distribucionRoles)
                        {
                            // Corregimos los errores de las l√≠neas 62 y 64 usando ?.Rol
                            var rolNombre = rol?.Rol;
                            var colorRol = rolNombre == "admin" ? "danger" : 
                                          rolNombre == "vendedor" ? "warning" : "info";
                            var iconoRol = rolNombre == "admin" ? "üë®‚Äçüíº" : 
                                          rolNombre == "vendedor" ? "üõí" : "üë§";
                            
                            <div class="mb-3 p-3" style="background: rgba(45, 53, 97, 0.3); border-radius: 10px; border-left: 4px solid #667eea;">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-0" style="text-transform: capitalize; color: #ffffff;">
                                            @iconoRol @rolNombre
                                        </h6>
                                    </div>
                                    <span class="badge bg-@colorRol" style="font-size: 1.2rem; padding: 0.5rem 1rem;">
                                        @(rol?.Cantidad ?? 0)
                                    </span>
                                </div>
                            </div>
                        }
                        
                        <div class="mt-4 text-center">
                            <p class="text-muted mb-2">Total de usuarios en el sistema</p>
                            <h3 style="color: #667eea;">@(config?.TotalUsuarios ?? 0) usuarios</h3>
                        </div>
                    }
                    else
                    {
                        <div class="alert alert-info">
                            No hay informaci√≥n de roles disponible.
                        </div>
                    }
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card fade-in-up">
                <div class="card-header">
                    <h5 class="mb-0 icon-glow">üìä Estad√≠sticas del Inventario</h5>
                </div>
                <div class="card-body">
                    <div class="mb-4">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span style="color: #b0b0b0;">üì¶ Total Productos</span>
                            <h4 class="mb-0" style="color: #4facfe;">@(config?.TotalProductos ?? 0)</h4>
                        </div>
                        <div class="progress" style="height: 10px; background-color: rgba(26, 31, 58, 0.8);">
                            <div class="progress-bar" style="width: 100%; background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);"></div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span style="color: #b0b0b0;">üè∑Ô∏è Categor√≠as</span>
                            <h4 class="mb-0" style="color: #38ef7d;">@(config?.TotalCategorias ?? 0)</h4>
                        </div>
                        <div class="progress" style="height: 10px; background-color: rgba(26, 31, 58, 0.8);">
                            <div class="progress-bar" style="width: 100%; background: linear-gradient(90deg, #11998e 0%, #38ef7d 100%);"></div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span style="color: #b0b0b0;">üè≠ Proveedores</span>
                            <h4 class="mb-0" style="color: #f5576c;">@(config?.TotalProveedores ?? 0)</h4>
                        </div>
                        <div class="progress" style="height: 10px; background-color: rgba(26, 31, 58, 0.8);">
                            <div class="progress-bar" style="width: 100%; background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%);"></div>
                        </div>
                    </div>

                    <div class="text-center mt-4 p-3" style="background: rgba(102, 126, 234, 0.1); border-radius: 10px;">
                        <p class="text-muted mb-1">Estado del Inventario</p>
                        <h5 style="color: #38ef7d;">‚úÖ Sistema Operativo</h5>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Informaci√≥n del Sistema -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card fade-in-up">
                <div class="card-header">
                    <h5 class="mb-0 icon-glow">‚ÑπÔ∏è Informaci√≥n del Sistema</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="p-3" style="background: rgba(45, 53, 97, 0.3); border-radius: 10px;">
                                <h6 style="color: #b0b0b0; margin-bottom: 1rem;">üñ•Ô∏è Detalles del Sistema</h6>
                                <dl class="row mb-0">
                                    <dt class="col-sm-5" style="color: #8e8e8e;">Nombre:</dt>
                                    <dd class="col-sm-7">Tienda de Repuestos SIFRA</dd>
                                    
                                    <dt class="col-sm-5" style="color: #8e8e8e;">Versi√≥n:</dt>
                                    <dd class="col-sm-7">1.0.0</dd>
                                    
                                    <dt class="col-sm-5" style="color: #8e8e8e;">Tipo:</dt>
                                    <dd class="col-sm-7">Sistema de Gesti√≥n</dd>
                                    
                                    <dt class="col-sm-5" style="color: #8e8e8e;">Framework:</dt>
                                    <dd class="col-sm-7">ASP.NET Core MVC</dd>
                                </dl>
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <div class="p-3" style="background: rgba(45, 53, 97, 0.3); border-radius: 10px;">
                                <h6 style="color: #b0b0b0; margin-bottom: 1rem;">üìà Estado Operacional</h6>
                                <dl class="row mb-0">
                                    <dt class="col-sm-5" style="color: #8e8e8e;">Estado:</dt>
                                    <dd class="col-sm-7">
                                        <span class="badge bg-success">üü¢ Activo</span>
                                    </dd>
                                    
                                    <dt class="col-sm-5" style="color: #8e8e8e;">Base de Datos:</dt>
                                    <dd class="col-sm-7">
                                        <span class="badge bg-success">‚úÖ Conectado</span>
                                    </dd>
                                    
                                    <dt class="col-sm-5" style="color: #8e8e8e;">Respaldo:</dt>
                                    <dd class="col-sm-7">
                                        <span class="badge bg-info">üìÖ Autom√°tico</span>
                                    </dd>
                                    
                                    <dt class="col-sm-5" style="color: #8e8e8e;">Seguridad:</dt>
                                    <dd class="col-sm-7">
                                        <span class="badge bg-success">üîí Habilitado</span>
                                    </dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Acciones R√°pidas de Configuraci√≥n -->
    <div class="row">
        <div class="col-md-12">
            <div class="card fade-in-up">
                <div class="card-header">
                    <h5 class="mb-0 icon-glow">‚ö° Acciones R√°pidas de Administraci√≥n</h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-3">
                            <a href="@Url.Action("Index", "Usuarios")" class="btn btn-outline-light w-100 py-3">
                                <div class="mb-2" style="font-size: 2rem;">üë•</div>
                                <div>Gestionar Usuarios</div>
                            </a>
                        </div>
                        <div class="col-md-3">
                            <a href="@Url.Action("Index", "Clientes")" class="btn btn-outline-light w-100 py-3">
                                <div class="mb-2" style="font-size: 2rem;">üë§</div>
                                <div>Gestionar Clientes</div>
                            </a>
                        </div>
                        <div class="col-md-3">
                            <a href="@Url.Action("Index", "Productos")" class="btn btn-outline-light w-100 py-3">
                                <div class="mb-2" style="font-size: 2rem;">üì¶</div>
                                <div>Gestionar Productos</div>
                            </a>
                        </div>
                        <div class="col-md-3">
                            <a href="@Url.Action("Index", "Ventas")" class="btn btn-outline-light w-100 py-3">
                                <div class="mb-2" style="font-size: 2rem;">üí∞</div>
                                <div>Ver Ventas</div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>